<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-blur { backdrop-filter: blur(15px); background: rgba(15, 23, 42, 0.8); }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .tab-active { background: #1e40af; color: white; }
    </style>
</head>
<body class="pb-24">

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 z-[9999] px-6 py-3 rounded-2xl text-white font-bold opacity-0 transition-all duration-300 pointer-events-none"></div>

    <div id="startScreen" class="fixed inset-0 bg-white z-[5000] flex flex-col items-center justify-center p-6 text-center">
        <div class="w-32 h-32 bg-blue-100 rounded-full flex items-center justify-center mb-6">
            <i class="fa-solid fa-utensils text-5xl text-blue-800"></i>
        </div>
        <h1 class="text-3xl font-black text-blue-900 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡</h1>
        <p class="text-slate-500 mb-10 font-bold">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        <button onclick="initApp('client')" class="w-full max-w-xs bg-blue-800 text-white py-6 rounded-[30px] font-black text-xl mb-4 shadow-xl active:scale-95 transition">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ğŸ›ï¸</button>
        <button onclick="checkCashier()" class="w-full max-w-xs bg-slate-100 text-slate-800 py-6 rounded-[30px] font-black text-xl border-2 border-slate-200 active:scale-95 transition">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± ğŸ–¥ï¸</button>
    </div>

    <div id="clientApp" class="hidden">
        <header class="bg-blue-800 text-white p-6 rounded-b-[40px] shadow-2xl sticky top-0 z-[100]">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-black">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</h1>
                <button onclick="location.reload()" class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center"><i class="fa-solid fa-rotate-left"></i></button>
            </div>
            <div id="categoryTabs" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
        </header>

        <main id="itemsGrid" class="p-4 space-y-4"></main>

        <div id="cartBar" onclick="openCartModal()" class="fixed bottom-6 left-6 right-6 bg-slate-900 text-white p-5 rounded-[30px] shadow-2xl z-[1000] hidden justify-between items-center slide-up border border-white/10">
            <div class="flex items-center gap-4">
                <div id="cartQty" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center font-black">0</div>
                <span class="font-black">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©</span>
            </div>
            <span id="cartTotal" class="text-2xl font-black text-blue-400">0ï·¼</span>
        </div>
    </div>

    <div id="cashierApp" class="hidden min-h-screen bg-slate-50">
        <header class="bg-slate-900 text-white p-6 flex justify-between items-center sticky top-0 z-50">
            <h2 class="font-black text-xl">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            <button onclick="location.reload()" class="bg-red-500/20 text-red-400 px-4 py-2 rounded-xl font-bold">Ø®Ø±ÙˆØ¬</button>
        </header>
        <div id="orderNotifications" class="p-4 space-y-4">
            <div class="text-center py-20 opacity-20 font-black">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ÙˆØµÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©...</div>
        </div>
    </div>

    <div id="mainModal" class="fixed inset-0 z-[2000] hidden modal-blur items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[40px] p-8 slide-up overflow-y-auto max-h-[90vh] relative shadow-2xl">
            <button onclick="closeModal()" class="absolute top-6 left-6 text-slate-400">âœ•</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ---
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù) ---
        const DB = {
            "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª": [
                {id:1, name:"ÙÙˆÙ„ Ø³Ø§Ø¯Ø©", sizes:{s:3, m:4, l:5, local:6}},
                {id:2, name:"ÙÙˆÙ„ Ù…Ø´ÙƒÙ„", sizes:{s:4, m:5, l:6, local:7}},
                {id:3, name:"ÙÙˆÙ„ Ù‚Ù„Ø§Ø¨Ø© Ø·Ø§ÙˆÙ‡", sizes:{s:4, m:5, l:6, local:7}},
                {id:5, name:"Ø¹Ø¯Ø³ Ø³Ø§Ø¯Ø©", sizes:{s:3, m:4, l:5, local:6}},
                {id:8, name:"ÙØ§ØµÙˆÙ„ÙŠÙ‡", sizes:{s:6, m:8, l:12, local:7}},
                {id:13, name:"ØªÙˆÙ†Ø©", sizes:{s:10, m:11, l:12, local:10}},
                {id:14, name:"Ø´ÙƒØ´ÙˆÙƒØ©", sizes:{s:6, m:7, l:8, local:7}},
                {id:19, name:"Ù„Ø­Ø³Ø©", sizes:{s:9, m:10, l:12, local:10}},
                {id:22, name:"ÙƒÙ…ÙˆÙ†ÙŠØ©", sizes:{s:10, m:12, l:15, local:11}}
            ],
            "Ø§Ù„Ù…Ø·Ø¨Ù‚": [
                {id:23, name:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", price:5},
                {id:24, name:"Ù…Ø·Ø¨Ù‚ Ù…Ø§Ù„Ø­", price:5},
                {id:25, name:"Ù…Ø·Ø¨Ù‚ Ù…ÙˆØ²", price:5},
                {id:33, name:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§", price:7}
            ],
            "Ø§Ù„Ø¹Ø±ÙŠÙƒØ© ÙˆØ§Ù„ÙØªØ©": [
                {id:34, name:"Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", price:12},
                {id:36, name:"Ù…Ù„ÙƒÙŠ", price:16},
                {id:38, name:"Ø¹Ø±ÙŠÙƒØ© Ù…Ø±ÙˆØ©", price:18}
            ],
            "Ø§Ù„ØªÙ…ÙŠØ³": [
                {id:56, name:"ØªÙ…ÙŠØ³ Ø¹Ø§Ø¯ÙŠ", price:1},
                {id:59, name:"ØªÙ…ÙŠØ³ Ø¬Ø¨Ù†", price:5},
                {id:66, name:"ØªÙ…ÙŠØ³ Ø¨Ø³ÙƒÙˆØª", price:3}
            ],
            "Ø§Ù„Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª": [
                {id:48, name:"ÙƒØ¨Ø¯Ø©", sizes:{samoli:4, fatira:5}},
                {id:50, name:"Ù…Ù‚Ù„Ù‚Ù„", sizes:{samoli:4, fatira:5}}
            ],
            "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª": [
                {id:71, name:"Ù…Ø§Ø¡", price:1},
                {id:74, name:"Ø´Ø§ÙŠ Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨", price:2}
            ]
        };

        let cart = [];
        let currentCat = "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª";

        function initApp(role) {
            document.getElementById('startScreen').classList.add('hidden');
            if(role === 'client') {
                document.getElementById('clientApp').classList.remove('hidden');
                renderTabs();
                renderItems();
            } else {
                document.getElementById('cashierApp').classList.remove('hidden');
                startOrderListener();
            }
        }

        function checkCashier() {
            const pass = prompt("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ÙƒØ§Ø´ÙŠØ±:");
            if(pass === "1234") initApp('cashier');
            else alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦");
        }

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…ÙŠÙ„
        function renderTabs() {
            const tabs = document.getElementById('categoryTabs');
            tabs.innerHTML = Object.keys(DB).map(cat => `
                <button onclick="setCat('${cat}')" class="px-6 py-2 rounded-2xl whitespace-nowrap font-black transition ${cat === currentCat ? 'bg-white text-blue-900 shadow-lg' : 'text-white/60'}">${cat}</button>
            `).join('');
        }

        function setCat(cat) { currentCat = cat; renderTabs(); renderItems(); }

        function renderItems() {
            const grid = document.getElementById('itemsGrid');
            grid.innerHTML = DB[currentCat].map(item => `
                <div class="bg-white rounded-[30px] p-6 shadow-sm border border-slate-100">
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-black text-xl text-blue-900">${item.name}</span>
                        ${item.price ? `<button onclick="addToCart('${item.name}', ${item.price})" class="bg-blue-800 text-white px-5 py-2 rounded-2xl font-black">+ ${item.price}ï·¼</button>` : ''}
                    </div>
                    ${item.sizes ? `<div class="grid grid-cols-2 gap-3">${Object.entries(item.sizes).map(([s, p]) => `
                        <button onclick="addToCart('${item.name} (${s})', ${p})" class="bg-slate-50 p-3 rounded-2xl flex justify-between items-center text-sm font-bold active:bg-blue-50 transition">
                            <span>${s}</span><span class="text-blue-700">${p}ï·¼</span>
                        </button>`).join('')}</div>` : ''}
                </div>`).join('');
        }

        function addToCart(name, price) {
            cart.push({name, price, id: Date.now()});
            const bar = document.getElementById('cartBar');
            bar.classList.replace('hidden', 'flex');
            document.getElementById('cartQty').innerText = cart.length;
            document.getElementById('cartTotal').innerText = cart.reduce((s,i) => s+i.price, 0) + "ï·¼";
            showToast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…", "#10b981");
        }

        function openCartModal() {
            const total = cart.reduce((s,i) => s+i.price, 0);
            let content = `
                <h2 class="text-2xl font-black mb-6 text-center">ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ ğŸ›’</h2>
                <div class="space-y-3 mb-8 max-h-60 overflow-y-auto">
                    ${cart.map(i => `<div class="flex justify-between font-bold bg-slate-50 p-4 rounded-2xl"><span>${i.name}</span><span>${i.price}ï·¼</span></div>`).join('')}
                </div>
                <div class="space-y-4">
                    <input id="cName" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" class="w-full p-4 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                    <input id="cLoc" type="text" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©" class="w-full p-4 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                    <select id="cPay" onchange="toggleCard(this.value)" class="w-full p-4 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                        <option>ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                        <option value="online">Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¯Ù‰)</option>
                    </select>
                    <div id="cardField" class="hidden slide-up p-4 bg-blue-50 rounded-2xl space-y-2">
                        <input type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" class="w-full p-3 rounded-xl border-none">
                        <div class="flex gap-2"><input type="text" placeholder="MM/YY" class="w-1/2 p-3 rounded-xl border-none"><input type="text" placeholder="CVV" class="w-1/2 p-3 rounded-xl border-none"></div>
                    </div>
                    <div class="flex justify-between py-4 border-t border-dashed mt-4"><span class="font-black text-slate-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span class="text-3xl font-black text-blue-800">${total}ï·¼</span></div>
                    <button onclick="submitOrder()" class="w-full bg-blue-800 text-white py-5 rounded-[25px] font-black text-xl shadow-xl">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
                </div>
            `;
            openModal(content);
        }

        function toggleCard(v) { document.getElementById('cardField').classList.toggle('hidden', v !== 'online'); }

        async function submitOrder() {
            const name = document.getElementById('cName').value;
            const loc = document.getElementById('cLoc').value;
            if(!name || !loc) return showToast("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âš ï¸", "#ef4444");

            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©... â˜ï¸");
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
            let geo = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            try {
                const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
                geo = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
            } catch(e) {}

            const order = {
                customerName: name,
                location: loc,
                geoLink: geo,
                items: cart,
                total: cart.reduce((s,i) => s+i.price, 0),
                payment: document.getElementById('cPay').value,
                status: 'pending',
                time: new Date().toLocaleTimeString('ar-SA'),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            await db.collection("orders").add(order);
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± âœ…");
            cart = []; location.reload();
        }

        // Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒØ§Ø´ÙŠØ± (Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„)
        function startOrderListener() {
            db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snap => {
                const container = document.getElementById('orderNotifications');
                container.innerHTML = "";
                if(snap.empty) container.innerHTML = `<div class="text-center py-20 opacity-20 font-black">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
                
                snap.forEach(doc => {
                    const o = doc.data();
                    if(o.status === 'pending') playSound();
                    
                    container.innerHTML += `
                        <div class="bg-white p-6 rounded-[35px] shadow-sm border-r-8 ${o.status==='pending'?'border-blue-600':'border-emerald-500'} mb-4">
                            <div class="flex justify-between mb-2">
                                <h3 class="font-black text-lg">${o.customerName}</h3>
                                <span class="text-xs bg-slate-100 px-3 py-1 rounded-full font-bold">${o.time}</span>
                            </div>
                            <p class="text-sm text-slate-500 font-bold mb-4"><i class="fa-solid fa-location-dot"></i> ${o.location}</p>
                            <div class="space-y-1 mb-4 border-t border-dashed pt-4">
                                ${o.items.map(i => `<div class="flex justify-between text-sm font-bold"><span>${i.name}</span><span>${i.price}ï·¼</span></div>`).join('')}
                            </div>
                            <div class="flex justify-between items-center pt-2">
                                <span class="text-2xl font-black text-blue-900">${o.total}ï·¼</span>
                                <div class="flex gap-2">
                                    <a href="${o.geoLink}" target="_blank" class="bg-slate-100 p-3 rounded-xl text-blue-600"><i class="fa-solid fa-map"></i></a>
                                    ${o.status === 'pending' ? 
                                    `<button onclick="approveOrder('${doc.id}')" class="bg-emerald-600 text-white px-6 py-2 rounded-xl font-black">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</button>` : 
                                    `<span class="text-emerald-600 font-black">ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ âœ…</span>`}
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        async function approveOrder(id) {
            await db.collection("orders").doc(id).update({status: 'approved'});
            showToast("ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ‘¨â€ğŸ³");
        }

        function playSound() { new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play(); }

        // Ù…Ø³Ø§Ø¹Ø¯Ø§Øª
        function openModal(html) { document.getElementById('modalContent').innerHTML = html; document.getElementById('mainModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('mainModal').style.display = 'none'; }
        function showToast(m, c) { 
            const t = document.getElementById('toast'); 
            t.innerText = m; t.style.background = c; t.style.opacity = 1;
            setTimeout(()=>t.style.opacity=0, 2500);
        }
    </script>
</body>
</html>
