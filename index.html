<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-blur { backdrop-filter: blur(15px); background: rgba(15, 23, 42, 0.8); }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .item-card { transition: all 0.3s ease; }
        .item-card:active { transform: scale(0.97); }
        #customToast { visibility: hidden; min-width: 280px; background-color: #1e293b; color: #fff; text-align: center; border-radius: 20px; padding: 16px; position: fixed; z-index: 10000; left: 50%; bottom: 120px; transform: translateX(-50%); opacity: 0; transition: 0.3s; }
        #customToast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="pb-40">

    <div id="customToast"></div>

    <header class="bg-blue-800 text-white p-6 rounded-b-[45px] shadow-2xl sticky top-0 z-[100]">
        <div class="flex justify-between items-center mb-6">
            <div><h1 class="text-2xl font-black italic">ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡</h1><p class="text-[10px] opacity-70 font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</p></div>
            <div class="flex gap-2">
                <button onclick="openCashierPanel()" class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center border border-white/20"><i class="fa-solid fa-bell text-lg"></i></button>
            </div>
        </div>
        <div id="categoryTabs" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
    </header>

    <main class="max-w-md mx-auto p-4">
        <div id="itemsGrid" class="space-y-4 pb-12"></div>
    </main>

    <div id="floatingCart" onclick="openCartModal()" class="fixed bottom-24 left-6 right-6 bg-slate-900 text-white p-5 rounded-[30px] shadow-2xl z-[1000] hidden justify-between items-center slide-up border border-white/10">
        <div class="flex items-center gap-4"><div id="cartCount" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center font-black">0</div><span class="font-black text-lg">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</span></div>
        <span id="floatingTotal" class="text-2xl font-black text-blue-400">0ï·¼</span>
    </div>

    <div id="mainModal" class="fixed inset-0 z-[2000] hidden modal-blur items-end justify-center">
        <div class="bg-white w-full max-w-lg rounded-t-[50px] p-8 slide-up overflow-y-auto max-h-[92vh] relative shadow-2xl">
            <button onclick="closeModal()" class="absolute top-6 left-6 w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 font-bold">âœ•</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© ---
        const DB = {
            "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª": [
                {id:1, name:"ÙÙˆÙ„ Ø³Ø§Ø¯Ø©", img:"ğŸ¥£", sizes:{s:3, m:4, l:5, local:6}},
                {id:2, name:"ÙÙˆÙ„ Ù…Ø´ÙƒÙ„", img:"ğŸ²", sizes:{s:4, m:5, l:6, local:7}},
                {id:3, name:"ÙÙˆÙ„ Ù‚Ù„Ø§Ø¨Ø© Ø·Ø§ÙˆÙ‡", img:"ğŸ”¥", sizes:{s:4, m:5, l:6, local:7}},
                {id:5, name:"Ø¹Ø¯Ø³ Ø³Ø§Ø¯Ø©", img:"ğŸ¥£", sizes:{s:3, m:4, l:5, local:6}},
                {id:13, name:"ØªÙˆÙ†Ø©", img:"ğŸŸ", sizes:{s:10, m:11, l:12, local:10}},
                {id:14, name:"Ø´ÙƒØ´ÙˆÙƒØ©", img:"ğŸ³", sizes:{s:6, m:7, l:8, local:7}},
                {id:22, name:"ÙƒÙ…ÙˆÙ†ÙŠØ©", img:"ğŸ¥˜", sizes:{s:10, m:12, l:15, local:11}}
            ],
            "Ø§Ù„Ù…Ø·Ø¨Ù‚": [
                {id:23, name:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", img:"ğŸŒ®", price:5},
                {id:24, name:"Ù…Ø·Ø¨Ù‚ Ù…Ø§Ù„Ø­", img:"ğŸ§€", price:5},
                {id:33, name:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§", img:"ğŸ«", price:7}
            ],
            "Ø§Ù„Ù…Ø¹ØµÙˆØ¨ ÙˆØ§Ù„Ø¹Ø±ÙŠÙƒØ©": [
                {id:34, name:"Ø¹Ø±ÙŠÙƒØ© Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", img:"ğŸ¯", price:12},
                {id:36, name:"Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ", img:"ğŸ‘‘", price:16},
                {id:41, name:"Ù…Ø¹ØµÙˆØ¨ Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", img:"ğŸŒ", price:12}
            ],
            "Ø§Ù„ØªÙ…ÙŠØ³": [
                {id:56, name:"ØªÙ…ÙŠØ³ Ø¹Ø§Ø¯ÙŠ", img:"ğŸ«“", price:1},
                {id:59, name:"ØªÙ…ÙŠØ³ Ø¬Ø¨Ù†", img:"ğŸ§€", price:5},
                {id:66, name:"ØªÙ…ÙŠØ³ Ø¨Ø³ÙƒÙˆØª", img:"ğŸª", price:3}
            ],
            "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª": [
                {id:71, name:"Ù…Ø§Ø¡", img:"ğŸ’§", price:1},
                {id:74, name:"Ø´Ø§ÙŠ Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨", img:"â˜•", price:2}
            ]
        };

        let cart = [];
        let currentCat = "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª";

        window.onload = () => { renderTabs(); renderItems(); };

        function renderTabs() {
            const h = document.getElementById('categoryTabs');
            h.innerHTML = Object.keys(DB).map(c => `<button onclick="setCat('${c}')" class="px-6 py-2 rounded-2xl whitespace-nowrap font-black transition-all ${currentCat===c ? 'bg-white text-blue-900 shadow-lg' : 'text-white/70'}">${c}</button>`).join('');
        }

        function setCat(c) { currentCat = c; renderTabs(); renderItems(); }

        function renderItems() {
            const h = document.getElementById('itemsGrid');
            h.innerHTML = DB[currentCat].map(i => `
                <div class="bg-white rounded-[35px] p-6 shadow-sm border border-slate-50 item-card">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${i.img}</span>
                            <span class="text-lg font-black text-blue-900">${i.name}</span>
                        </div>
                        ${i.price ? `<button onclick="addToCart('${i.name}', ${i.price})" class="bg-blue-800 text-white px-6 py-2 rounded-xl font-black shadow-md">+ ${i.price}ï·¼</button>` : ''}
                    </div>
                    ${i.sizes ? `<div class="grid grid-cols-2 gap-2">${Object.entries(i.sizes).map(([s,p]) => `
                        <button onclick="addToCart('${i.name} (${getSizeName(s)})', ${p})" class="bg-slate-50 p-3 rounded-2xl flex justify-between items-center text-xs font-bold active:bg-blue-50">
                            <span class="text-slate-500">${getSizeName(s)}</span><span class="text-blue-800">${p}ï·¼</span>
                        </button>`).join('')}</div>` : ''}
                </div>`).join('');
        }

        function getSizeName(s) { return {s:'ØµØºÙŠØ±', m:'ÙˆØ³Ø·', l:'ÙƒØ¨ÙŠØ±', local:'Ù…Ø­Ù„ÙŠ'}[s] || s; }

        function addToCart(name, price) {
            cart.push({ name, price, id: Date.now() });
            updateCartUI();
            showToast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…");
        }

        function updateCartUI() {
            const total = cart.reduce((s,i) => s + i.price, 0);
            document.getElementById('floatingCart').style.display = cart.length > 0 ? 'flex' : 'none';
            document.getElementById('cartCount').innerText = cart.length;
            document.getElementById('floatingTotal').innerText = total + "ï·¼";
        }

        function openCartModal() {
            const total = cart.reduce((s,i) => s + i.price, 0);
            let h = `<h2 class="text-2xl font-black mb-6 text-center text-blue-900">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ ğŸ›’</h2>
                     <div class="space-y-3 mb-8">`;
            h += cart.map((i, index) => `<div class="flex justify-between font-bold bg-slate-50 p-4 rounded-2xl"><span>${i.name}</span><button onclick="removeFromCart(${index})" class="text-red-500">âœ•</button></div>`).join('');
            h += `</div><div class="space-y-4">
                    <input id="uName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" class="w-full p-5 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                    <input id="uLoc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø£Ùˆ Ø­ÙŠ Ø¨Ø¯Ø± (Ù„Ù„ØªÙˆØµÙŠÙ„)" class="w-full p-5 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                    <div class="flex justify-between items-center py-4 border-t-2 border-dashed">
                        <span class="font-black text-slate-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span class="text-3xl font-black text-blue-900">${total}ï·¼</span>
                    </div>
                    <button onclick="sendOrder()" class="w-full bg-green-600 text-white py-6 rounded-[30px] font-black text-xl shadow-xl">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
                  </div>`;
            openModal(h);
        }

        async function sendOrder() {
            const n = document.getElementById('uName').value;
            const l = document.getElementById('uLoc').value;
            if(!n || !l) return showToast("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âš ï¸", "#ef4444");

            const order = {
                customer: n,
                location: l,
                items: cart,
                total: cart.reduce((s,i) => s + i.price, 0),
                status: 'new',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                // 1. Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Firebase
                await db.collection("orders").add(order);
                
                // 2. Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ù‡Ø°Ø§ Ù…Ø§ ÙƒØ§Ù† ÙŠÙ†Ù‚ØµÙƒ)
                openModal(`
                    <div class="text-center py-10">
                        <div class="w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-5xl">âœ…</div>
                        <h2 class="text-3xl font-black text-blue-900 mb-4">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</h2>
                        <p class="text-slate-500 font-bold mb-8">Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù† Ù„Ø¯Ù‰ Ø§Ù„ÙƒØ§Ø´ÙŠØ±ØŒ Ø³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ²Ù‡ ÙÙˆØ±Ø§Ù‹.</p>
                        <button onclick="location.reload()" class="w-full bg-blue-800 text-white py-5 rounded-3xl font-black shadow-lg">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                    </div>
                `);
                
                cart = []; updateCartUI();
            } catch (e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message); }
        }

        // --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± (Ù„Ù„Ù…Ø­Ù„ ÙÙ‚Ø·) ---
        function openCashierPanel() {
            const p = prompt("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:");
            if(p !== "1234") return;
            
            openModal(`<div id="liveOrders" class="space-y-4 min-h-[50vh]"><p class="text-center py-10">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p></div>`);
            
            db.collection("orders").orderBy("createdAt", "desc").limit(10).onSnapshot(snap => {
                const h = document.getElementById('liveOrders');
                if(!h) return;
                h.innerHTML = `<h2 class="text-xl font-black mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ğŸ“¡</h2>`;
                snap.forEach(doc => {
                    const o = doc.data();
                    h.innerHTML += `
                        <div class="bg-slate-50 p-5 rounded-3xl border-r-8 ${o.status==='new'?'border-blue-600':'border-slate-300'} mb-3">
                            <div class="flex justify-between font-black mb-2"><span>${o.customer}</span><span class="text-blue-600">${o.total}ï·¼</span></div>
                            <div class="text-xs text-slate-500 mb-2">${o.location}</div>
                            <div class="border-t pt-2 text-[10px] font-bold">
                                ${o.items.map(it => `â€¢ ${it.name}`).join('<br>')}
                            </div>
                            ${o.status === 'new' ? `<button onclick="approveOrder('${doc.id}')" class="w-full bg-blue-600 text-white py-2 rounded-xl mt-3 font-bold text-xs">Ù‚Ø¨ÙˆÙ„</button>` : ''}
                        </div>`;
                });
            });
        }

        async function approveOrder(id) {
            await db.collection("orders").doc(id).update({ status: 'done' });
            new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play();
        }

        function removeFromCart(i) { cart.splice(i, 1); openCartModal(); updateCartUI(); }
        function openModal(c) { document.getElementById('modalContent').innerHTML = c; document.getElementById('mainModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('mainModal').style.display = 'none'; }
        function showToast(m, c="#1e293b") { const t = document.getElementById("customToast"); t.innerText = m; t.style.backgroundColor = c; t.classList.add("show"); setTimeout(() => t.classList.remove("show"), 2000); }
    </script>
</body>
</html>
