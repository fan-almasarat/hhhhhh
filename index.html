<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ø±ÙˆÙ‡ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© | 2030</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --primary: #059669; --secondary: #1e40af; --accent: #f59e0b; --dark: #0f172a; }
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; overflow-x: hidden; }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.3); }
        .view-section { display: none; min-height: 100vh; animation: slideUp 0.4s ease-out; }
        .view-section.active { display: block; }
        @keyframes slideUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø°ÙƒÙŠ */
        .bottom-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 75px; background: var(--dark); border-radius: 25px; display: flex; justify-content: space-around; align-items: center; z-index: 9999; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .nav-btn { color: #64748b; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.3s; }
        .nav-btn.active { color: #fff; transform: translateY(-8px); }
        .nav-btn.active i { background: var(--primary); padding: 12px; border-radius: 15px; box-shadow: 0 10px 20px rgba(5,150,105,0.3); }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†ÙŠÙˆ */
        .item-card { background: white; border-radius: 30px; overflow: hidden; transition: 0.3s; border: 1px solid #f1f5f9; }
        .item-card:active { transform: scale(0.96); }
        
        /* Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-badge { padding: 4px 12px; border-radius: 10px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .status-new { background: #fee2e2; color: #ef4444; }
        .status-preparing { background: #fef3c7; color: #d97706; }
        .status-ready { background: #dcfce7; color: #059669; }
        .status-delivery { background: #e0e7ff; color: #4338ca; }
    </style>
</head>
<body class="pb-32">

    <section id="view-customer" class="view-section active">
        <header class="p-8 bg-white border-b">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-black text-emerald-900">ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ âœ¨</h1>
                    <p class="text-xs font-bold text-slate-400">ÙØ·ÙˆØ±Ùƒ Ø§Ù„Ø´Ø¹Ø¨ÙŠ Ø³Ø§Ø®Ù† ÙˆØ¹Ø§Ù„Ø·Ù„Ø¨</p>
                </div>
                <div class="w-12 h-12 bg-slate-100 rounded-2xl flex items-center justify-center text-xl"><i class="fas fa-search text-slate-400"></i></div>
            </div>
            
            <div class="flex gap-4 overflow-x-auto no-scrollbar mt-8 py-2">
                <button class="px-6 py-3 bg-emerald-600 text-white rounded-2xl font-black whitespace-nowrap shadow-lg shadow-emerald-100">Ø§Ù„ÙƒÙ„</button>
                <button class="px-6 py-3 bg-white text-slate-500 rounded-2xl font-bold border whitespace-nowrap">ÙÙˆÙ„ ÙˆÙ…Ø¹ØµÙˆØ¨</button>
                <button class="px-6 py-3 bg-white text-slate-500 rounded-2xl font-bold border whitespace-nowrap">Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ</button>
                <button class="px-6 py-3 bg-white text-slate-500 rounded-2xl font-bold border whitespace-nowrap">Ù…Ø·Ø¨Ù‚</button>
            </div>
        </header>

        <main class="p-6">
            <div id="customer-menu" class="grid grid-cols-2 gap-6">
                </div>
        </main>
    </section>

    <section id="view-cashier" class="view-section p-6">
        <div class="flex justify-between items-end mb-8">
            <h2 class="text-4xl font-black italic">Ù„ÙˆØ­Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± ğŸ–¥ï¸</h2>
            <div id="stats-summary" class="bg-emerald-100 text-emerald-700 px-6 py-3 rounded-2xl font-black text-sm">
                Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: 0 ï·¼
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cashier-orders">
            </div>
    </section>

    <section id="view-driver" class="view-section p-6">
        <div class="bg-slate-900 rounded-[35px] p-8 text-white mb-8 relative overflow-hidden">
            <div class="relative z-10">
                <h3 class="text-2xl font-black mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„ ğŸï¸</h3>
                <p class="text-white/50 text-xs font-bold">Ù„Ø¯ÙŠÙƒ <span id="pending-deliveries-count">0</span> Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙˆØµÙŠÙ„</p>
            </div>
            <i class="fas fa-motorcycle absolute -bottom-4 -left-4 text-9xl text-white/5 rotate-12"></i>
        </div>

        <div id="driver-orders" class="space-y-6">
            </div>
    </section>

    <section id="view-track" class="view-section p-6">
        <div id="no-active-order" class="flex flex-col items-center justify-center py-40 opacity-20">
            <i class="fas fa-map-location-dot text-8xl mb-6"></i>
            <p class="text-xl font-black">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø· Ù„Ù…ØªØ§Ø¨Ø¹ØªÙ‡</p>
        </div>

        <div id="tracking-card" class="hidden">
            <div class="bg-white rounded-[40px] p-8 shadow-2xl border-b-8 border-emerald-500">
                <div class="flex justify-between items-center mb-10">
                    <h3 class="text-2xl font-black">ØªØªØ¨Ø¹ Ø±Ø­Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                    <span id="track-order-id" class="text-xs bg-slate-100 px-4 py-2 rounded-xl font-bold text-slate-500">#---</span>
                </div>

                <div class="space-y-12">
                    <div class="flex gap-6 relative">
                        <div class="w-1 bg-slate-100 absolute h-full right-5 top-10 -z-10"></div>
                        <div id="step1" class="w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg"><i class="fas fa-check"></i></div>
                        <div><p class="font-black text-lg">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</p><p class="text-xs text-slate-400 font-bold">Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø·Ø¨Ø®</p></div>
                    </div>
                    <div class="flex gap-6 relative">
                        <div id="step2" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center"><i class="fas fa-fire-burner"></i></div>
                        <div><p class="font-black text-lg">ÙŠØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¢Ù†</p><p class="text-xs text-slate-400 font-bold">Ø¹Ù„Ù‰ Ù†Ø§Ø± Ù‡Ø§Ø¯Ø¦Ø©</p></div>
                    </div>
                    <div class="flex gap-6">
                        <div id="step3" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center"><i class="fas fa-motorcycle"></i></div>
                        <div><p class="font-black text-lg">Ø®Ø±Ø¬ Ù„Ù„ØªÙˆØµÙŠÙ„</p><p id="driver-status-text" class="text-xs text-slate-400 font-bold">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <nav class="bottom-nav">
        <button onclick="changeView('customer')" class="nav-btn active" id="btn-customer">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[10px] font-extrabold">Ø§Ù„Ù…ØªØ¬Ø±</span>
        </button>
        <button onclick="changeView('track')" class="nav-btn" id="btn-track">
            <i class="fas fa-route text-xl"></i>
            <span class="text-[10px] font-extrabold">Ø§Ù„ØªØªØ¨Ø¹</span>
        </button>
        <button onclick="changeView('cashier')" class="nav-btn" id="btn-cashier">
            <i class="fas fa-desktop text-xl"></i>
            <span class="text-[10px] font-extrabold">Ø§Ù„ÙƒØ§Ø´ÙŠØ±</span>
        </button>
        <button onclick="changeView('driver')" class="nav-btn" id="btn-driver">
            <i class="fas fa-biking text-xl"></i>
            <span class="text-[10px] font-extrabold">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</span>
        </button>
    </nav>

    <div id="cart-float" class="fixed bottom-28 left-6 right-6 h-18 bg-emerald-600 rounded-3xl shadow-2xl z-50 flex items-center justify-between px-8 text-white hidden transform animate-bounce">
        <div class="flex items-center gap-4">
            <span id="cart-count" class="bg-white text-emerald-600 w-8 h-8 rounded-full flex items-center justify-center font-black">0</span>
            <span id="cart-total" class="font-black text-lg">0 ï·¼</span>
        </div>
        <button onclick="submitOrder()" class="font-black">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ <i class="fas fa-chevron-left mr-2"></i></button>
    </div>

    <script>
        // --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ù†Ø¸Ø§Ù… (The Core Engine) ---
        const config = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(config);
        const db = firebase.firestore();

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù (Ø¹ÙŠÙ†Ø© Ù…Ù† 200 ØµÙ†Ù Ù…ÙØªØ±Ø¶)
        const MENU_DATA = [
            {id:1, n:"ÙÙˆÙ„ Ø¬Ø±Ø© Ø³Ø§Ø¯Ø©", p:6, img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=400"},
            {id:2, n:"ÙÙˆÙ„ Ù‚Ù„Ø§Ø¨Ø© Ø·Ø§ÙˆÙ‡", p:8, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=400"},
            {id:3, n:"Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ ÙØ§Ø®Ø±", p:18, img:"https://images.unsplash.com/photo-1589113103503-49ef83d89e7c?w=400"},
            {id:4, n:"Ù…Ø¹ØµÙˆØ¨ Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", p:15, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400"},
            {id:5, n:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", p:7, img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400"},
            {id:6, n:"ØªÙ…ÙŠØ³ Ø¨Ø³Ù…Ù† Ø¨Ø±ÙŠ", p:3, img:"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400"},
            {id:7, n:"Ø¹Ø¯Ø³ Ø­Ø¬Ø§Ø²ÙŠ", p:7, img:"https://images.unsplash.com/photo-1547592166-23ac45744acd?w=400"},
            {id:8, n:"Ø´ÙƒØ´ÙˆÙƒØ© Ø¹Ø¯Ù†ÙŠ", p:9, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=400"}
        ];

        let cart = [];
        let activeOrderID = localStorage.getItem('marwa_order_id');

        window.onload = () => {
            renderCustomerMenu();
            syncOrders();
            if(activeOrderID) trackOrder(activeOrderID);
        };

        // 1. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù…ÙŠÙ„
        function renderCustomerMenu() {
            const grid = document.getElementById('customer-menu');
            grid.innerHTML = MENU_DATA.map(item => `
                <div class="item-card shadow-sm" onclick="addItem(${item.id})">
                    <div class="h-32 bg-slate-100 relative">
                        <img src="${item.img}" class="w-full h-full object-cover">
                        <div class="absolute bottom-2 left-2 bg-white/90 backdrop-blur px-3 py-1 rounded-xl text-[10px] font-black">${item.p} ï·¼</div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold text-slate-800 text-xs">${item.n}</h4>
                        <div class="flex justify-between items-center mt-3">
                            <span class="text-[8px] text-slate-400 font-bold uppercase">Freshly Made</span>
                            <div class="w-8 h-8 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center text-xs"><i class="fas fa-plus"></i></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addItem(id) {
            const item = MENU_DATA.find(x => x.id === id);
            cart.push(item);
            updateCartUI();
        }

        function updateCartUI() {
            const float = document.getElementById('cart-float');
            if(cart.length > 0) {
                float.classList.remove('hidden');
                document.getElementById('cart-count').innerText = cart.length;
                document.getElementById('cart-total').innerText = cart.reduce((s,i)=>s+i.p,0) + " ï·¼";
            }
        }

        async function submitOrder() {
            const order = {
                items: cart,
                total: cart.reduce((s,i)=>s+i.p,0),
                status: 'new',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            const doc = await db.collection("orders").add(order);
            activeOrderID = doc.id;
            localStorage.setItem('marwa_order_id', doc.id);
            cart = [];
            document.getElementById('cart-float').classList.add('hidden');
            changeView('track');
            trackOrder(activeOrderID);
        }

        // 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØªØ¨Ø¹
        function trackOrder(id) {
            db.collection("orders").doc(id).onSnapshot(doc => {
                if(!doc.exists) return;
                const o = doc.data();
                document.getElementById('no-active-order').classList.add('hidden');
                document.getElementById('tracking-card').classList.remove('hidden');
                document.getElementById('track-order-id').innerText = "#" + id.slice(-5);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ØªÙŠØ¨Ø³
                const s2 = document.getElementById('step2'), s3 = document.getElementById('step3');
                if(o.status === 'preparing') { s2.classList.replace('bg-slate-200','bg-amber-500'); s2.classList.replace('text-slate-400','text-white'); }
                if(o.status === 'ready') { s2.className = "w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg"; s3.classList.replace('bg-slate-200','bg-blue-600'); s3.classList.replace('text-slate-400','text-white'); }
                if(o.status === 'delivered') { s3.className = "w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg"; document.getElementById('driver-status-text').innerText = "ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…"; }
            });
        }

        // 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨ (Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©)
        function syncOrders() {
            db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snap => {
                const cashierGrid = document.getElementById('cashier-orders');
                const driverGrid = document.getElementById('driver-orders');
                let dailyTotal = 0;
                let readyForDeliveryCount = 0;

                cashierGrid.innerHTML = "";
                driverGrid.innerHTML = "";

                snap.forEach(doc => {
                    const o = doc.data();
                    dailyTotal += o.total;

                    // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±
                    cashierGrid.innerHTML += `
                        <div class="bg-white p-8 rounded-[35px] shadow-sm border-2 ${o.status==='new'?'border-emerald-500 animate-pulse':'border-transparent'}">
                            <div class="flex justify-between mb-4">
                                <span class="font-black">#${doc.id.slice(-5)}</span>
                                <span class="status-badge ${o.status==='new'?'status-new':o.status==='preparing'?'status-preparing':'status-ready'}">${o.status}</span>
                            </div>
                            <div class="text-sm font-bold text-slate-500 mb-6">${o.items.map(i=>i.n).join(' + ')}</div>
                            <div class="flex gap-2">
                                <button onclick="updateStatus('${doc.id}', 'preparing')" class="flex-1 bg-amber-500 text-white py-3 rounded-xl font-black text-xs">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
                                <button onclick="updateStatus('${doc.id}', 'ready')" class="flex-1 bg-emerald-600 text-white py-3 rounded-xl font-black text-xs">ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²</button>
                            </div>
                        </div>
                    `;

                    // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                    if(o.status === 'ready' || o.status === 'delivery') {
                        readyForDeliveryCount++;
                        driverGrid.innerHTML += `
                            <div class="bg-white p-8 rounded-[40px] shadow-lg border-l-8 border-blue-600">
                                <div class="flex justify-between items-center mb-6">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center"><i class="fas fa-box"></i></div>
                                        <div><p class="font-black text-lg">Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²</p><p class="text-[10px] font-bold text-slate-400">Ø­ÙŠ Ø¨Ø¯Ø± - Ø§Ù„Ø±ÙŠØ§Ø¶</p></div>
                                    </div>
                                    <span class="text-xl font-black">${o.total} ï·¼</span>
                                </div>
                                <button onclick="updateStatus('${doc.id}', 'delivered')" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-xl shadow-blue-100">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„ØªØ­ØµÙŠÙ„ âœ…</button>
                            </div>
                        `;
                    }
                });
                document.getElementById('stats-summary').innerText = `Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${dailyTotal} ï·¼`;
                document.getElementById('pending-deliveries-count').innerText = readyForDeliveryCount;
            });
        }

        async function updateStatus(id, s) { await db.collection("orders").doc(id).update({status: s}); }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª
        function changeView(view) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById('view-' + view).classList.add('active');
            document.getElementById('btn-' + view).classList.add('active');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
