<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ Ø§Ù„Ø´Ø§Ù…Ù„Ø© 2030</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #059669; --secondary: #1e40af; --dark: #0f172a; --gold: #d4af37; }
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; color: var(--dark); margin: 0; padding: 0; }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª */
        .app-view { display: none; min-height: 100vh; padding-bottom: 100px; animation: fadeIn 0.4s ease; }
        .app-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 85px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #e2e8f0; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-link { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #94a3b8; cursor: pointer; transition: 0.3s; width: 25%; }
        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 1.4rem; }
        .nav-link span { font-size: 0.7rem; font-weight: 900; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card-shadow { box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; }
        .btn-primary { background: var(--primary); color: white; border-radius: 18px; font-weight: 800; transition: 0.3s; }
        .btn-primary:active { transform: scale(0.95); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯ÙØ¹ */
        #payment-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); display: none; z-index: 2000; align-items: end; }
        .payment-box { background: white; width: 100%; max-width: 500px; border-radius: 40px 40px 0 0; padding: 30px; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="view-client" class="app-view active">
        <header class="p-6 bg-white sticky top-0 z-50 flex justify-between items-center border-b">
            <div>
                <h1 class="text-2xl font-black text-emerald-800 italic">ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ âœ¨</h1>
                <p class="text-[10px] font-bold text-slate-400">ÙØ·ÙˆØ± Ø£Ù‡Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø·ÙŠØ¨ÙŠÙ†</p>
            </div>
            <div class="flex gap-3">
                <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500"><i class="fas fa-bell"></i></div>
                <div class="w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center font-black">M</div>
            </div>
        </header>

        <div class="p-6 space-y-8">
            <div class="h-44 rounded-[35px] bg-gradient-to-r from-emerald-900 to-emerald-700 p-8 text-white relative overflow-hidden shadow-xl">
                <div class="relative z-10">
                    <h2 class="text-3xl font-black italic mb-2">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø¹Ø©!</h2>
                    <p class="text-emerald-100 text-sm opacity-80">Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ø±ÙŠÙƒØ©</p>
                </div>
                <i class="fas fa-bowl-food absolute -bottom-4 -left-4 text-9xl text-white/10 rotate-12"></i>
            </div>

            <div id="menu-container" class="grid grid-cols-2 gap-4">
                </div>
        </div>
    </div>

    <div id="view-track" class="app-view p-6 bg-slate-50">
        <h2 class="text-3xl font-black mb-8 italic">ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ ğŸ›°ï¸</h2>
        
        <div id="no-order-ui" class="text-center py-20 opacity-20">
            <i class="fas fa-box-open text-7xl mb-6"></i>
            <p class="font-black text-xl">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</p>
        </div>

        <div id="tracking-ui" class="hidden space-y-6">
            <div class="bg-white p-8 rounded-[40px] shadow-sm border-2 border-emerald-500/10">
                <div class="flex justify-between items-center mb-10">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</p>
                        <p id="track-id" class="text-xl font-black italic text-emerald-800">#----</p>
                    </div>
                    <div class="px-4 py-2 bg-emerald-100 text-emerald-700 rounded-2xl text-[10px] font-black animate-pulse">ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±</div>
                </div>

                <div class="relative space-y-12">
                    <div class="absolute right-[19px] top-4 bottom-4 w-1 bg-slate-100 -z-10"></div>
                    
                    <div class="flex items-center gap-6">
                        <div id="step-new" class="w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg"><i class="fas fa-check"></i></div>
                        <div><p class="font-black">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p><p class="text-[10px] text-slate-400">Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ø·Ù„Ø¨Ùƒ ÙˆØ¨Ø¯Ø£Ù†Ø§ Ø§Ù„Ø¹Ù…Ù„</p></div>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <div id="step-preparing" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center transition-all duration-500"><i class="fas fa-fire"></i></div>
                        <div><p class="font-black">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±</p><p class="text-[10px] text-slate-400">Ø·Ù„Ø¨Ùƒ ØªØ­Øª Ø£ÙŠØ¯ÙŠ Ø´ÙŠÙ Ù…Ø±ÙˆÙ‡</p></div>
                    </div>

                    <div class="flex items-center gap-6">
                        <div id="step-ready" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center transition-all duration-500"><i class="fas fa-motorcycle"></i></div>
                        <div><p class="font-black">Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</p><p id="driver-info" class="text-[10px] text-slate-400">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø®Ø±ÙˆØ¬Ù‡ Ù…Ù† Ø§Ù„Ù…Ø·Ø¨Ø®</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-cashier" class="app-view p-6 bg-slate-900 text-white">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-3xl font-black italic">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø¨Ø® ğŸ–¥ï¸</h2>
            <div class="bg-emerald-500/20 text-emerald-400 px-6 py-2 rounded-2xl font-black text-xs border border-emerald-500/30">
                Ø§Ù„ÙŠÙˆÙ…: <span id="cashier-total">0</span> ï·¼
            </div>
        </div>

        <div id="cashier-list" class="space-y-6">
            </div>
    </div>

    <div id="view-driver" class="app-view p-6 bg-blue-50">
        <div class="bg-blue-600 rounded-[35px] p-8 text-white mb-10 shadow-xl relative overflow-hidden">
            <h2 class="text-2xl font-black mb-2">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸï¸</h2>
            <p class="text-blue-100 text-xs font-bold">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø³Ø§Ø®Ù†Ø§Ù‹</p>
            <i class="fas fa-map-marker-alt absolute -bottom-4 -left-4 text-9xl text-white/10 rotate-12"></i>
        </div>

        <div id="driver-list" class="space-y-6">
            </div>
    </div>

    <div id="payment-modal">
        <div class="payment-box">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-black italic">Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ù…Ù† ğŸ’³</h3>
                <button onclick="closePayment()" class="text-slate-300"><i class="fas fa-times-circle text-2xl"></i></button>
            </div>
            
            <div class="space-y-6">
                <div class="flex gap-4 mb-8">
                    <div class="flex-1 h-16 border-2 border-emerald-500 bg-emerald-50 rounded-2xl flex items-center justify-center"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" class="h-8"></div>
                    <div class="flex-1 h-16 border-2 border-slate-100 rounded-2xl flex items-center justify-center opacity-40"><img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/Mada_Logo.svg" class="h-4"></div>
                </div>

                <input type="text" id="card-number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (16 Ø±Ù‚Ù…)" class="w-full p-5 bg-slate-50 rounded-2xl border-none font-bold text-center focus:ring-2 ring-emerald-500">
                
                <div class="flex gap-4">
                    <input type="text" placeholder="MM/YY" class="w-1/2 p-5 bg-slate-50 rounded-2xl border-none font-bold text-center">
                    <input type="text" placeholder="CVV" class="w-1/2 p-5 bg-slate-50 rounded-2xl border-none font-bold text-center">
                </div>

                <div class="py-4 border-t border-dashed flex justify-between items-center">
                    <span class="font-bold text-slate-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
                    <span id="payment-amount" class="text-3xl font-black text-emerald-700">0 ï·¼</span>
                </div>

                <button onclick="processPayment()" id="pay-btn" class="w-full py-6 btn-primary text-xl shadow-xl shadow-emerald-100">Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>
        </div>
    </div>

    <div id="cart-dock" class="fixed bottom-24 left-6 right-6 h-20 bg-emerald-600 rounded-[28px] shadow-2xl z-[500] flex items-center justify-between px-8 text-white hidden animate-bounce">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center font-black" id="cart-count">0</div>
            <span id="cart-total-price" class="text-xl font-black italic">0 ï·¼</span>
        </div>
        <button onclick="openPayment()" class="font-black flex items-center gap-2 italic">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ <i class="fas fa-chevron-left"></i></button>
    </div>

    <nav class="bottom-nav">
        <div class="nav-link active" onclick="switchView('client', this)"><i class="fas fa-utensils"></i><span>Ø§Ù„Ù…ØªØ¬Ø±</span></div>
        <div class="nav-link" onclick="switchView('track', this)"><i class="fas fa-route"></i><span>ØªØªØ¨Ø¹</span></div>
        <div class="nav-link" onclick="switchView('cashier', this)"><i class="fas fa-terminal"></i><span>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</span></div>
        <div class="nav-link" onclick="switchView('driver', this)"><i class="fas fa-biking"></i><span>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</span></div>
    </nav>

    <script>
        // --- Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„ØªÙ‚Ù†ÙŠ (Firebase & Data) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
        const PRODUCTS = [
            {id:101, n:"ÙÙˆÙ„ Ø¬Ø±Ø© Ø¨Ø§Ù„Ø³Ù…Ù†", p:8, img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=400"},
            {id:102, n:"Ù‚Ù„Ø§Ø¨Ø© ÙƒØ´Ù†Ø© Ø­Ø¬Ø§Ø²ÙŠØ©", p:9, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=400"},
            {id:103, n:"Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ Ø¯Ø¨Ù„ Ù‚Ø´Ø·Ø©", p:22, img:"https://images.unsplash.com/photo-1589113103503-49ef83d89e7c?w=400"},
            {id:104, n:"Ù…Ø¹ØµÙˆØ¨ Ù…Ù„ÙƒÙŠ Ø¨Ø§Ù„Ø¹Ø³Ù„", p:18, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400"},
            {id:105, n:"Ù…Ø·Ø¨Ù‚ Ù…Ø§Ù„Ø­ Ø®Ø¶Ø§Ø±", p:7, img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400"},
            {id:106, n:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§ Ø¨Ø§Ù„Ù…ÙˆØ²", p:14, img:"https://images.unsplash.com/photo-1551024601-bec78aea704b?w=400"},
            {id:107, n:"ØªÙ…ÙŠØ³ Ø¨Ø± Ù…Ù† Ø§Ù„ÙØ±Ù†", p:2, img:"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400"},
            {id:108, n:"Ø´ÙƒØ´ÙˆÙƒØ© Ø¹Ø¯Ù†ÙŠ Ø³Ø¨Ø§ÙŠØ³ÙŠ", p:12, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=400"}
        ];

        let cart = [];
        let activeOrderID = localStorage.getItem('lastOrder');

        // --- 1. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ---
        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = PRODUCTS.map(item => `
                <div class="bg-white rounded-[30px] overflow-hidden card-shadow relative" onclick="addToCart(${item.id})">
                    <img src="${item.img}" class="h-32 w-full object-cover">
                    <div class="p-4">
                        <h3 class="font-black text-xs text-slate-700">${item.n}</h3>
                        <div class="flex justify-between items-center mt-3">
                            <span class="text-emerald-600 font-black">${item.p} ï·¼</span>
                            <div class="w-8 h-8 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center text-xs"><i class="fas fa-plus"></i></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const item = PRODUCTS.find(p => p.id === id);
            cart.push(item);
            const dock = document.getElementById('cart-dock');
            dock.classList.remove('hidden');
            document.getElementById('cart-count').innerText = cart.length;
            document.getElementById('cart-total-price').innerText = cart.reduce((s,i)=>s+i.p,0) + " ï·¼";
            // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ· Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            if(navigator.vibrate) navigator.vibrate(50);
        }

        function openPayment() {
            const total = cart.reduce((s,i)=>s+i.p,0);
            document.getElementById('payment-amount').innerText = total + " ï·¼";
            document.getElementById('payment-modal').style.display = 'flex';
        }

        function closePayment() {
            document.getElementById('payment-modal').style.display = 'none';
        }

        async function processPayment() {
            const card = document.getElementById('card-number').value;
            if(card.length < 16) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© ØµØ­ÙŠØ­");
            
            const btn = document.getElementById('pay-btn');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚... â³";
            btn.disabled = true;

            const order = {
                items: cart,
                total: cart.reduce((s,i)=>s+i.p,0),
                status: 'new',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                const doc = await db.collection("orders").add(order);
                activeOrderID = doc.id;
                localStorage.setItem('lastOrder', doc.id);
                cart = [];
                document.getElementById('cart-dock').classList.add('hidden');
                closePayment();
                switchView('track', document.querySelector('[onclick*="track"]'));
                startTracking(doc.id);
            } catch(e) { alert("ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"); }
        }

        // --- 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØªØ¨Ø¹ ---
        function startTracking(id) {
            if(!id) return;
            document.getElementById('no-order-ui').classList.add('hidden');
            document.getElementById('tracking-ui').classList.remove('hidden');
            
            db.collection("orders").doc(id).onSnapshot(doc => {
                if(!doc.exists) return;
                const o = doc.data();
                document.getElementById('track-id').innerText = "#" + id.slice(-5);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù…ÙˆØ²
                const stepPrep = document.getElementById('step-preparing');
                const stepReady = document.getElementById('step-ready');
                
                if(o.status === 'preparing' || o.status === 'ready' || o.status === 'delivered') {
                    stepPrep.classList.replace('bg-slate-200','bg-amber-500');
                    stepPrep.classList.replace('text-slate-400','text-white');
                }
                if(o.status === 'ready' || o.status === 'delivered') {
                    stepReady.classList.replace('bg-slate-200','bg-blue-600');
                    stepReady.classList.replace('text-slate-400','text-white');
                    document.getElementById('driver-info').innerText = "Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ ğŸï¸";
                }
                if(o.status === 'delivered') {
                    stepReady.className = "w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg";
                    document.getElementById('driver-info').innerText = "ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø¨Ø§Ù„Ø¹Ø§ÙÙŠØ©! â¤ï¸";
                }
            });
        }

        // --- 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨ ---
        function syncManagement() {
            db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snap => {
                const cashierList = document.getElementById('cashier-list');
                const driverList = document.getElementById('driver-list');
                let totalToday = 0;

                cashierList.innerHTML = "";
                driverList.innerHTML = "";

                snap.forEach(doc => {
                    const o = doc.data();
                    totalToday += o.total;

                    // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±
                    cashierList.innerHTML += `
                        <div class="bg-slate-800 p-6 rounded-[30px] border-l-4 ${o.status==='new'?'border-emerald-500 animate-pulse':'border-slate-600'}">
                            <div class="flex justify-between items-center mb-4">
                                <span class="font-black">#${doc.id.slice(-5)}</span>
                                <span class="text-[10px] bg-slate-700 px-3 py-1 rounded-full text-emerald-400">${o.status}</span>
                            </div>
                            <div class="text-xs text-slate-400 mb-6 font-bold leading-relaxed">${o.items.map(i=>i.n).join(' + ')}</div>
                            <div class="flex gap-2">
                                <button onclick="updateOrderStatus('${doc.id}', 'preparing')" class="flex-1 bg-amber-500 py-3 rounded-xl font-black text-[10px]">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
                                <button onclick="updateOrderStatus('${doc.id}', 'ready')" class="flex-1 bg-emerald-600 py-3 rounded-xl font-black text-[10px]">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØµÙŠÙ„</button>
                            </div>
                        </div>
                    `;

                    // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© ÙÙ‚Ø·)
                    if(o.status === 'ready') {
                        driverList.innerHTML += `
                            <div class="bg-white p-8 rounded-[40px] shadow-sm border-2 border-blue-100">
                                <div class="flex justify-between items-center mb-6">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center"><i class="fas fa-box"></i></div>
                                        <div><p class="font-black text-lg">Ø·Ù„Ø¨ #...${doc.id.slice(-3)}</p><p class="text-[10px] font-bold text-slate-400">Ø­ÙŠ Ø¨Ø¯Ø± - Ø§Ù„Ø±ÙŠØ§Ø¶</p></div>
                                    </div>
                                    <span class="text-2xl font-black">${o.total} ï·¼</span>
                                </div>
                                <button onclick="updateOrderStatus('${doc.id}', 'delivered')" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„ØªØ­ØµÙŠÙ„ âœ…</button>
                            </div>
                        `;
                    }
                });
                document.getElementById('cashier-total').innerText = totalToday;
            });
        }

        async function updateOrderStatus(id, status) {
            await db.collection("orders").doc(id).update({status: status});
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø© ---
        function switchView(viewId, el) {
            document.querySelectorAll('.app-view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            document.getElementById('view-' + viewId).classList.add('active');
            el.classList.add('active');
            window.scrollTo(0,0);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
        window.onload = () => {
            renderMenu();
            syncManagement();
            if(activeOrderID) startTracking(activeOrderID);
        };
    </script>
</body>
</html>
