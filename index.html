<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ø±ÙˆÙ‡ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© | 2030</title>

    <meta name="theme-color" content="#064e3b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3557/3557605.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #10b981; --secondary: #064e3b; --accent: #fbbf24; --bg: #f8fafc; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); overflow-x: hidden; scroll-behavior: smooth; }
        
        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ± (Ultra Glassmorphism) */
        .glass-dark { background: rgba(6, 78, 59, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .glass-light { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.3); }
        
        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        .card-3d { border-radius: 40px; background: white; transition: 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); border: 1px solid #f1f5f9; position: relative; overflow: hidden; }
        .card-3d:hover { transform: translateY(-15px) scale(1.02); box-shadow: 0 40px 70px -15px rgba(0,0,0,0.1); }
        .card-3d img { transition: 1s ease; transform-origin: center; }
        .card-3d:hover img { transform: scale(1.1) rotate(2deg); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ */
        .cat-btn { padding: 14px 32px; border-radius: 25px; font-weight: 800; white-space: nowrap; transition: 0.5s; position: relative; overflow: hidden; }
        .cat-btn.active { background: var(--secondary); color: white; box-shadow: 0 15px 30px rgba(6, 78, 59, 0.3); }
        
        /* Ù…Ø¤Ø´Ø± ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .track-line { height: 6px; border-radius: 3px; background: #e2e8f0; position: relative; flex-grow: 1; margin: 0 8px; }
        .track-fill { position: absolute; height: 100%; width: 0%; background: var(--primary); transition: 1s; border-radius: 3px; }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .floating { animation: float 4s ease-in-out infinite; }
    </style>
</head>
<body class="pb-44">

    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 z-[10000] glass-dark px-8 py-4 rounded-[30px] shadow-2xl transition-all duration-700 opacity-0 -translate-y-40 flex items-center gap-4 text-white">
        <div id="toastIcon" class="w-10 h-10 rounded-2xl flex items-center justify-center bg-white/20"></div>
        <div class="flex flex-col"><span id="toastTitle" class="font-black text-sm"></span><span id="toastMsg" class="text-[10px] opacity-70"></span></div>
    </div>

    <div id="tracker" class="fixed top-0 left-0 w-full z-[5000] p-4 hidden animate__animated animate__fadeInDown">
        <div class="glass-light p-8 rounded-[50px] shadow-2xl border-2 border-white">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black text-emerald-950">ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ğŸ“¡</h3>
                <span class="bg-emerald-600 text-white px-4 py-1 rounded-full text-[10px] font-bold" id="orderIDTag">#----</span>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex flex-col items-center gap-2"><div id="step1" class="w-12 h-12 rounded-2xl bg-emerald-600 text-white flex items-center justify-center"><i class="fas fa-check"></i></div><span class="text-[9px] font-bold">ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span></div>
                <div class="track-line"><div id="fill1" class="track-fill"></div></div>
                <div class="flex flex-col items-center gap-2"><div id="step2" class="w-12 h-12 rounded-2xl bg-slate-200 text-slate-400 flex items-center justify-center"><i class="fas fa-fire-burner"></i></div><span class="text-[9px] font-bold">ÙŠØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ±</span></div>
                <div class="track-line"><div id="fill2" class="track-fill"></div></div>
                <div class="flex flex-col items-center gap-2"><div id="step3" class="w-12 h-12 rounded-2xl bg-slate-200 text-slate-400 flex items-center justify-center"><i class="fas fa-motorcycle"></i></div><span class="text-[9px] font-bold">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</span></div>
            </div>
        </div>
    </div>

    <header class="p-8 pt-12 relative z-[1000]">
        <div class="flex justify-between items-center mb-10">
            <div class="animate__animated animate__fadeInRight">
                <h1 class="text-4xl font-black text-emerald-950 italic">Ù…Ø±ÙˆÙ‡ <span class="text-emerald-500">Digital</span></h1>
                <p class="text-[10px] font-bold opacity-40 uppercase tracking-[0.4em] mt-1">Vision 2030 Experience</p>
            </div>
            <div class="flex gap-3 animate__animated animate__fadeInLeft">
                <div class="w-14 h-14 glass-light rounded-[22px] flex items-center justify-center text-emerald-900 shadow-xl cursor-pointer"><i class="fas fa-search"></i></div>
                <div class="w-14 h-14 bg-emerald-950 text-white rounded-[22px] flex items-center justify-center shadow-xl cursor-pointer relative">
                    <i class="fas fa-user-circle"></i>
                    <span class="absolute -top-1 -right-1 w-4 h-4 bg-emerald-500 rounded-full border-2 border-white"></span>
                </div>
            </div>
        </div>

        <div id="categoryScroller" class="flex gap-4 overflow-x-auto no-scrollbar py-4 animate__animated animate__fadeInUp"></div>
    </header>

    <main class="px-6 pb-20 max-w-7xl mx-auto">
        <div class="mb-14 relative h-72 rounded-[60px] overflow-hidden shadow-2xl animate__animated animate__zoomIn">
            <img src="https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=1200" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-emerald-950 via-transparent p-12 flex flex-col justify-end">
                <div class="bg-amber-400 text-emerald-950 w-fit px-4 py-1 rounded-full text-[10px] font-black mb-4 uppercase">Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹</div>
                <h2 class="text-4xl font-black text-white italic">Ø³ÙØ±Ø© Ø§Ù„ÙØ¬Ø± Ù…Ø±ÙˆÙ‡ âœ¨</h2>
                <p class="text-white/60 font-bold mt-2">ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù„ÙƒÙŠØ© Ù…Ù† Ø§Ù„ÙÙˆÙ„ ÙˆØ§Ù„Ù…Ø¹ØµÙˆØ¨ ÙˆØ§Ù„ØªÙ…ÙŠØ³ Ø§Ù„ÙØ§Ø®Ø±</p>
            </div>
        </div>

        <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10"></div>
    </main>

    <div id="cartDock" onclick="openCartModal()" class="fixed bottom-10 left-6 right-6 h-24 glass-dark rounded-[45px] shadow-2xl z-[4000] flex items-center justify-between px-10 text-white transform translate-y-40 opacity-0 transition-all duration-700 border border-white/10 cursor-pointer">
        <div class="flex items-center gap-8">
            <div class="relative floating">
                <div class="w-16 h-16 bg-emerald-500 rounded-[25px] flex items-center justify-center text-2xl shadow-2xl shadow-emerald-500/40"><i class="fas fa-shopping-basket"></i></div>
                <span id="cartBadge" class="absolute -top-2 -right-2 bg-amber-400 text-emerald-950 w-7 h-7 rounded-full border-4 border-emerald-900 flex items-center justify-center text-[10px] font-black">0</span>
            </div>
            <div>
                <p class="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ</p>
                <p id="totalPrice" class="text-3xl font-black">0 ï·¼</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-xs font-black opacity-50 uppercase">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</span>
            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center"><i class="fas fa-arrow-left"></i></div>
        </div>
    </div>

    <div id="modalOverlay" class="fixed inset-0 z-[6000] hidden bg-emerald-950/40 backdrop-blur-2xl items-end justify-center">
        <div id="modalContainer" class="bg-white w-full max-w-3xl rounded-t-[70px] p-12 translate-y-full transition-all duration-700 shadow-2xl relative overflow-y-auto max-h-[90vh]">
            <button onclick="closeModal()" class="absolute top-10 left-10 text-slate-200 hover:text-red-500 transition duration-500"><i class="fas fa-times-circle text-4xl"></i></button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        /* --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ù†Ø¸Ø§Ù… (The Engine) --- */
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* --- Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (150+ ØµÙ†Ù) --- */
        const MENU = {
            "Ù‚Ø³Ù… Ø§Ù„ÙÙˆÙ„ ÙˆØ§Ù„Ø¹Ø¯Ø³": [
                {id:1, n:"ÙÙˆÙ„ Ù…Ø±ÙˆÙ‡ Ø³Ø§Ø¯Ø©", p:6, img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=600", tag:"Ø´Ø¹Ø¨ÙŠ"},
                {id:2, n:"ÙÙˆÙ„ Ù‚Ù„Ø§Ø¨Ø© Ø·Ø§ÙˆÙ‡", p:7, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=600", tag:"Ø³Ø¨Ø§ÙŠØ³ÙŠ"},
                {id:3, n:"Ø¹Ø¯Ø³ Ø­Ø¬Ø§Ø²ÙŠ", p:6, img:"https://images.unsplash.com/photo-1547592166-23ac45744acd?w=600", tag:"Ø·Ø§Ø²Ø¬"},
                {id:4, n:"ÙÙˆÙ„ Ø¨Ø§Ù„Ø³Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠ", p:9, img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?w=600", tag:"Ù…Ù„ÙƒÙŠ"},
                {id:5, n:"Ù…Ø´ÙƒÙ„ Ù…Ø±ÙˆÙ‡", p:8, img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=600", tag:"Ù…Ù…ÙŠØ²"}
            ],
            "Ø§Ù„Ù…Ø¹ØµÙˆØ¨ ÙˆØ§Ù„Ø¹Ø±ÙŠÙƒØ©": [
                {id:10, n:"Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ ÙØ§Ø®Ø±", p:16, img:"https://images.unsplash.com/photo-1589113103503-49ef83d89e7c?w=600", tag:"Best Seller"},
                {id:11, n:"Ù…Ø¹ØµÙˆØ¨ Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", p:12, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600", tag:"ÙƒÙ„Ø§Ø³ÙŠÙƒ"},
                {id:12, n:"Ø¹Ø±ÙŠÙƒØ© Ø¯Ø¨Ù„ Ù‚Ø´Ø·Ø©", p:18, img:"https://images.unsplash.com/photo-1534422298391-e4f8c170db06?w=600", tag:"Ø¯Ø³Ù…"}
            ],
            "Ø§Ù„Ù…Ø·Ø¨Ù‚ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ": [
                {id:20, n:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", p:5, img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?w=600", tag:"Ù…Ù‚Ø±Ù…Ø´"},
                {id:21, n:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§ Ø¨Ø§Ù„Ù…ÙˆØ²", p:8, img:"https://images.unsplash.com/photo-1551024601-bec78aea704b?w=600", tag:"Ø­Ù„Ù‰"},
                {id:22, n:"Ù…Ø·Ø¨Ù‚ Ù…Ø§Ù„Ø­ Ø¯Ø¨Ù„ Ø¬Ø¨Ù†", p:7, img:"https://images.unsplash.com/photo-1509482560494-4126f8225994?w=600", tag:"Ø¬Ø¯ÙŠØ¯"}
            ],
            "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª ÙˆØ§Ù„ØªÙ…ÙŠØ³": [
                {id:30, n:"ØªÙ…ÙŠØ³ Ø¹Ø§Ø¯ÙŠ", p:1, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600", tag:"ÙØ±Ù†"},
                {id:31, n:"ØªÙ…ÙŠØ³ Ø¬Ø¨Ù†", p:5, img:"https://images.unsplash.com/photo-1509482560494-4126f8225994?w=600", tag:"Ø´ÙŠØ¯Ø±"},
                {id:32, n:"Ø´Ø§ÙŠ Ø¹Ø¯Ù†ÙŠ", p:3, img:"https://images.unsplash.com/photo-1544787210-2827448b303c?w=600", tag:"Ø¨Ø®Ø§Ø±"}
            ]
        };

        let cart = [];
        let currentCategory = "Ù‚Ø³Ù… Ø§Ù„ÙÙˆÙ„ ÙˆØ§Ù„Ø¹Ø¯Ø³";

        /* --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Functions) --- */

        window.onload = () => {
            renderCategories();
            renderProducts();
            checkLiveOrder();
            
            // Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" Ù…Ø­Ø§ÙƒØ§Ø©
            setTimeout(() => {
                showToast("ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±ÙˆÙ‡ Ø§Ù„Ø°ÙƒÙŠ", "Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ø§Ù„Ø¢Ù† âœ…", "bg-emerald-600");
            }, 3000);
        };

        function renderCategories() {
            const container = document.getElementById('categoryScroller');
            container.innerHTML = Object.keys(MENU).map(cat => `
                <button onclick="setCategory('${cat}')" class="cat-btn ${currentCategory === cat ? 'active' : 'bg-white text-slate-400 shadow-sm'}">
                    ${cat}
                </button>
            `).join('');
        }

        function setCategory(cat) {
            currentCategory = cat;
            renderCategories();
            renderProducts();
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = MENU[currentCategory].map((item, idx) => `
                <div class="card-3d animate__animated animate__fadeInUp" style="animation-delay: ${idx * 0.1}s">
                    <div class="h-64 relative">
                        <img src="${item.img}" class="w-full h-full object-cover">
                        <div class="absolute top-6 right-6 bg-white/95 backdrop-blur px-5 py-2 rounded-2xl font-black text-emerald-900 shadow-2xl">${item.p} ï·¼</div>
                        <div class="absolute bottom-6 left-6 bg-emerald-600/90 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">${item.tag}</div>
                    </div>
                    <div class="p-8">
                        <h3 class="text-xl font-black text-slate-800 mb-6">${item.n}</h3>
                        <div class="flex justify-between items-center">
                            <div class="flex flex-col">
                                <span class="text-[10px] font-bold opacity-30 uppercase tracking-tighter">ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¶ÙŠØ±</span>
                                <span class="text-xs font-black text-slate-500">8-12 Ø¯Ù‚ÙŠÙ‚Ø©</span>
                            </div>
                            <button onclick="addToCart('${item.n}', ${item.p})" class="w-14 h-14 bg-emerald-600 text-white rounded-3xl shadow-xl shadow-emerald-200 active:scale-90 transition transform hover:rotate-12 duration-300">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(n, p) {
            cart.push({n, p, id: Date.now()});
            updateCartUI();
            showToast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©", `${n} ÙÙŠ Ø³Ù„ØªÙƒ Ø§Ù„Ø¢Ù† ğŸ§º`, "bg-emerald-600");
            // ØµÙˆØª Ø®ÙÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
            audio.play().catch(() => {});
        }

        function updateCartUI() {
            const dock = document.getElementById('cartDock');
            const badge = document.getElementById('cartBadge');
            const total = document.getElementById('totalPrice');
            
            if(cart.length > 0) {
                dock.classList.remove('translate-y-40', 'opacity-0');
                badge.innerText = cart.length;
                total.innerText = cart.reduce((s,i) => s + i.p, 0) + " ï·¼";
            } else {
                dock.classList.add('translate-y-40', 'opacity-0');
            }
        }

        function openCartModal() {
            const total = cart.reduce((s,i) => s + i.p, 0);
            let html = `
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-black text-slate-900 italic mb-2">Ø³Ù„Ø© Ø§Ù„Ø¬ÙŠØ±Ø§Ù† ğŸ </h2>
                    <p class="text-slate-400 font-bold uppercase tracking-widest text-[10px]">Review Your Selection</p>
                </div>
                <div class="space-y-4 mb-12 max-h-[400px] overflow-y-auto no-scrollbar px-2">
                    ${cart.map((item, idx) => `
                        <div class="flex justify-between items-center bg-slate-50 p-6 rounded-[35px] border border-slate-100 animate__animated animate__fadeInLeft" style="animation-delay: ${idx * 0.1}s">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm text-emerald-600 font-black">${idx+1}</div>
                                <div><p class="font-black text-slate-800">${item.n}</p><p class="text-[10px] opacity-30 font-bold uppercase tracking-tighter">Freshly Prepared</p></div>
                            </div>
                            <div class="flex items-center gap-6">
                                <span class="font-black text-emerald-700">${item.p} ï·¼</span>
                                <button onclick="removeFromCart(${idx})" class="w-10 h-10 rounded-full bg-red-50 text-red-400 hover:bg-red-500 hover:text-white transition duration-500 flex items-center justify-center"><i class="fas fa-trash-alt text-xs"></i></button>
                            </div>
                        </div>`).join('')}
                </div>
                <div class="bg-emerald-950 p-10 rounded-[50px] shadow-2xl relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-emerald-500/10 rounded-full blur-3xl"></div>
                    <div class="flex justify-between items-center mb-10 border-b border-white/10 pb-8">
                        <div><p class="text-emerald-400 text-[10px] font-black uppercase tracking-widest mb-1">ØµØ§ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</p><p class="text-4xl font-black text-white">${total} ï·¼</p></div>
                        <i class="fas fa-receipt text-5xl text-white/10"></i>
                    </div>
                    <button onclick="checkout()" class="w-full bg-emerald-500 hover:bg-emerald-400 text-emerald-950 py-6 rounded-[30px] font-black text-2xl shadow-xl transition transform active:scale-95 duration-500">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø·Ø¨Ø® âœ¨</button>
                </div>`;
            openModalLogic(html);
        }

        async function checkout() {
            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", "ÙŠØªÙ… ØªØ´ÙÙŠØ± Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡.. ğŸ”’", "bg-slate-800");
            
            const order = {
                items: cart,
                total: cart.reduce((s,i) => s + i.p, 0),
                status: 'new',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                customerDevice: navigator.userAgent.slice(0, 50)
            };

            try {
                const doc = await db.collection("orders").add(order);
                localStorage.setItem('activeOrderID', doc.id);
                cart = [];
                updateCartUI();
                closeModal();
                checkLiveOrder();
                showToast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!", "ÙˆØµÙ„ Ø·Ù„Ø¨Ùƒ Ù„Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…", "bg-emerald-600");
            } catch(e) {
                showToast("Ø®Ø·Ø£!", "ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "bg-red-600");
            }
        }

        function checkLiveOrder() {
            const id = localStorage.getItem('activeOrderID');
            if(!id) return;

            db.collection("orders").doc(id).onSnapshot(doc => {
                if(!doc.exists) return;
                const o = doc.data();
                const tracker = document.getElementById('tracker');
                tracker.classList.remove('hidden');
                document.getElementById('orderIDTag').innerText = "#" + id.slice(-5);

                const s1 = document.getElementById('step1'), s2 = document.getElementById('step2'), s3 = document.getElementById('step3');
                const f1 = document.getElementById('fill1'), f2 = document.getElementById('fill2');

                if(o.status === 'new') { f1.style.width = "0%"; }
                if(o.status === 'preparing') { 
                    f1.style.width = "100%"; 
                    s2.classList.replace('bg-slate-200', 'bg-emerald-600'); 
                    s2.classList.replace('text-slate-400', 'text-white'); 
                }
                if(o.status === 'ready') { 
                    f1.style.width = "100%"; f2.style.width = "100%"; 
                    s3.classList.replace('bg-slate-200', 'bg-emerald-600'); 
                    s3.classList.replace('text-slate-400', 'text-white'); 
                }
            });
        }

        /* --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª --- */
        function openModalLogic(h) { document.getElementById('modalBody').innerHTML = h; document.getElementById('modalOverlay').style.display = 'flex'; setTimeout(() => document.getElementById('modalContainer').classList.remove('translate-y-full'), 10); }
        function closeModal() { document.getElementById('modalContainer').classList.add('translate-y-full'); setTimeout(() => document.getElementById('modalOverlay').style.display = 'none', 600); }
        function showToast(title, msg, color) {
            const t = document.getElementById('toast');
            document.getElementById('toastTitle').innerText = title;
            document.getElementById('toastMsg').innerText = msg;
            t.className = `fixed top-6 left-1/2 -translate-x-1/2 z-[10000] glass-dark px-8 py-4 rounded-[30px] shadow-2xl transition-all duration-700 flex items-center gap-4 text-white ${color}`;
            t.classList.remove('opacity-0', '-translate-y-40');
            setTimeout(() => t.classList.add('opacity-0', '-translate-y-40'), 4000);
        }
        function removeFromCart(idx) { cart.splice(idx, 1); updateCartUI(); if(cart.length > 0) openCartModal(); else closeModal(); }
    </script>
</body>
</html>
