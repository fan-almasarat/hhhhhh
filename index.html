<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-blur { backdrop-filter: blur(15px); background: rgba(15, 23, 42, 0.7); }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .item-card { transition: all 0.3s ease; border: 1px solid #e2e8f0; }
        .item-card:active { transform: scale(0.98); }
        .category-btn.active { background: #1e40af; color: white; box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.3); }
        #toast { visibility: hidden; min-width: 250px; background: #1e293b; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 10000; left: 50%; bottom: 100px; transform: translateX(-50%); opacity: 0; transition: 0.5s; }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="pb-32">

    <div id="toast">ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…</div>

    <div id="startGate" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center p-6 text-center">
        <div class="w-32 h-32 bg-blue-50 rounded-full flex items-center justify-center mb-6 border-4 border-blue-100">
            <i class="fa-solid fa-store text-5xl text-blue-800"></i>
        </div>
        <h1 class="text-3xl font-black text-blue-900 mb-2">ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡</h1>
        <p class="text-slate-500 mb-10 font-bold italic underline decoration-blue-200">ÙØ±Ø¹ Ø­ÙŠ Ø¨Ø¯Ø± - Ø¬Ø§Ø²Ø§Ù†</p>
        <button onclick="enterApp('client')" class="w-full max-w-xs bg-blue-800 text-white py-6 rounded-[30px] font-black text-xl mb-4 shadow-xl active:scale-95 transition">Ø·Ù„Ø¨ Ø·Ø¹Ø§Ù… (Ø²Ø¨ÙˆÙ†) ğŸ›’</button>
        <button onclick="enterApp('cashier')" class="w-full max-w-xs bg-slate-100 text-slate-800 py-6 rounded-[30px] font-black text-xl border-2 border-slate-200 active:scale-95 transition text-sm">Ù„ÙˆØ­Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± (Ø¥Ø¯Ø§Ø±Ø©) âš™ï¸</button>
    </div>

    <div id="clientView" class="hidden">
        <header class="bg-blue-800 text-white p-6 rounded-b-[50px] sticky top-0 z-50 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-black italic">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>
                <button onclick="location.reload()" class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center"><i class="fa-solid fa-house"></i></button>
            </div>
            <div id="tabs" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
        </header>

        <main id="itemsGrid" class="p-4 grid grid-cols-1 gap-4"></main>

        <div id="cartBar" onclick="showCart()" class="fixed bottom-8 left-6 right-6 bg-slate-900 text-white p-5 rounded-[35px] shadow-2xl z-[1000] hidden justify-between items-center slide-up border border-white/10">
            <div class="flex items-center gap-4">
                <div id="cartQty" class="bg-blue-600 w-12 h-12 rounded-full flex items-center justify-center font-black text-xl shadow-lg">0</div>
                <div><p class="text-[10px] opacity-60 font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨</p><p class="font-black text-lg">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©</p></div>
            </div>
            <span id="cartTotal" class="text-2xl font-black text-blue-400">0ï·¼</span>
        </div>
    </div>

    <div id="cashierView" class="hidden min-h-screen bg-slate-100">
        <header class="bg-slate-900 text-white p-6 sticky top-0 z-50 flex justify-between items-center">
            <h2 class="font-black text-xl">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­ÙŠØ© ğŸ“¡</h2>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded-xl font-bold">Ø®Ø±ÙˆØ¬</button>
        </header>
        <div id="liveOrders" class="p-4 space-y-4"></div>
    </div>

    <div id="modal" class="fixed inset-0 z-[2000] hidden modal-blur items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[45px] p-8 slide-up overflow-y-auto max-h-[92vh] relative">
            <button onclick="closeModal()" class="absolute top-6 left-6 w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-400 font-bold">âœ•</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ ---
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© ---
        const DB = {
            "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª": [
                {id:1, name:"ÙÙˆÙ„ Ø³Ø§Ø¯Ø©", img:"ğŸ¥£", sizes:{s:3, m:4, l:5, local:6}},
                {id:2, name:"ÙÙˆÙ„ Ù…Ø´ÙƒÙ„", img:"ğŸ²", sizes:{s:4, m:5, l:6, local:7}},
                {id:5, name:"Ø¹Ø¯Ø³ Ø³Ø§Ø¯Ø©", img:"ğŸ¥£", sizes:{s:3, m:4, l:5, local:6}},
                {id:13, name:"ØªÙˆÙ†Ø©", img:"ğŸŸ", sizes:{s:10, m:11, l:12, local:10}},
                {id:14, name:"Ø´ÙƒØ´ÙˆÙƒØ©", img:"ğŸ³", sizes:{s:6, m:7, l:8, local:7}},
                {id:22, name:"ÙƒÙ…ÙˆÙ†ÙŠØ©", img:"ğŸ¥˜", sizes:{s:10, m:12, l:15, local:11}}
            ],
            "Ø§Ù„Ù…Ø·Ø¨Ù‚": [
                {id:23, name:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", img:"ğŸŒ®", price:5},
                {id:24, name:"Ù…Ø·Ø¨Ù‚ Ù…Ø§Ù„Ø­", img:"ğŸ§€", price:5},
                {id:33, name:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§", img:"ğŸ«", price:7}
            ],
            "Ø§Ù„Ø¹Ø±ÙŠÙƒØ© ÙˆØ§Ù„ÙØªØ©": [
                {id:34, name:"Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", img:"ğŸ¯", price:12},
                {id:36, name:"Ù…Ù„ÙƒÙŠ", img:"ğŸ‘‘", price:16},
                {id:38, name:"Ø¹Ø±ÙŠÙƒØ© Ù…Ø±ÙˆØ©", img:"âœ¨", price:18}
            ],
            "Ø§Ù„ØªÙ…ÙŠØ³": [
                {id:56, name:"ØªÙ…ÙŠØ³ Ø¹Ø§Ø¯ÙŠ", img:"ğŸ«“", price:1},
                {id:59, name:"ØªÙ…ÙŠØ³ Ø¬Ø¨Ù†", img:"ğŸ§€", price:5},
                {id:66, name:"ØªÙ…ÙŠØ³ Ø¨Ø³ÙƒÙˆØª", img:"ğŸª", price:3}
            ],
            "Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª": [
                {id:71, name:"Ù…Ø§Ø¡", img:"ğŸ’§", price:1},
                {id:74, name:"Ø´Ø§ÙŠ Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨", img:"â˜•", price:2}
            ]
        };

        let cart = [];
        let currentCat = "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª";

        function enterApp(role) {
            document.getElementById('startGate').style.display = 'none';
            if(role === 'client') {
                document.getElementById('clientView').classList.remove('hidden');
                renderTabs(); renderItems();
            } else {
                const p = prompt("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ÙƒØ§Ø´ÙŠØ±:");
                if(p === "1234") {
                    document.getElementById('cashierView').classList.remove('hidden');
                    startListener();
                } else { location.reload(); }
            }
        }

        function renderTabs() {
            const h = document.getElementById('tabs');
            h.innerHTML = Object.keys(DB).map(c => `
                <button onclick="setCat('${c}')" class="category-btn px-8 py-3 rounded-2xl whitespace-nowrap font-black transition-all ${currentCat===c ? 'active' : 'text-white/60'}">${c}</button>
            `).join('');
        }

        function setCat(c) { currentCat = c; renderTabs(); renderItems(); }

        function renderItems() {
            const h = document.getElementById('itemsGrid');
            h.innerHTML = DB[currentCat].map(i => `
                <div class="item-card bg-white rounded-[35px] p-5 flex flex-col shadow-sm">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center text-3xl shadow-inner">${i.img}</div>
                            <span class="font-black text-blue-900 text-lg">${i.name}</span>
                        </div>
                        ${i.price ? `<button onclick="addToCart('${i.name}', ${i.price})" class="bg-blue-800 text-white px-6 py-3 rounded-2xl font-black shadow-lg active:scale-90 transition">+ ${i.price}ï·¼</button>` : ''}
                    </div>
                    ${i.sizes ? `<div class="grid grid-cols-2 gap-2 mt-4 pt-4 border-t border-dashed">${Object.entries(i.sizes).map(([s,p]) => `
                        <button onclick="addToCart('${i.name} (${getSizeName(s)})', ${p})" class="bg-slate-50 p-3 rounded-2xl flex justify-between items-center text-xs font-bold active:bg-blue-50">
                            <span class="text-slate-500">${getSizeName(s)}</span><span class="text-blue-800">${p}ï·¼</span>
                        </button>`).join('')}</div>` : ''}
                </div>
            `).join('');
        }

        function getSizeName(s) { return {s:'ØµØºÙŠØ±', m:'ÙˆØ³Ø·', l:'ÙƒØ¨ÙŠØ±', local:'Ù…Ø­Ù„ÙŠ'}[s] || s; }

        function addToCart(name, price) {
            cart.push({name, price, id:Date.now()});
            updateCart();
            const t = document.getElementById("toast");
            t.className = "show"; setTimeout(()=>t.className="", 2000);
        }

        function updateCart() {
            const count = cart.length;
            const total = cart.reduce((s,i)=>s+i.price, 0);
            const bar = document.getElementById('cartBar');
            bar.style.display = count > 0 ? 'flex' : 'none';
            document.getElementById('cartQty').innerText = count;
            document.getElementById('cartTotal').innerText = total + "ï·¼";
        }

        function showCart() {
            const total = cart.reduce((s,i)=>s+i.price, 0);
            let h = `<h2 class="text-2xl font-black mb-6 text-center text-blue-900">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ›’</h2>
                     <div class="space-y-3 mb-8 max-h-60 overflow-y-auto">`;
            h += cart.map(i => `<div class="flex justify-between font-bold bg-slate-50 p-4 rounded-2xl"><span>${i.name}</span><span>${i.price}ï·¼</span></div>`).join('');
            h += `</div><div class="space-y-4">
                <input id="userName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" class="w-full p-5 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                <input id="userLoc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="w-full p-5 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                <select id="userPay" onchange="togglePay(this.value)" class="w-full p-5 bg-slate-100 rounded-2xl border-none outline-none font-bold">
                    <option value="cash">ğŸ’µ ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                    <option value="online">ğŸ’³ Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ù…Ø¯Ù‰)</option>
                </select>
                <div id="onlineField" class="hidden p-4 bg-blue-50 rounded-2xl space-y-2 slide-up">
                    <input type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" class="w-full p-3 rounded-xl border-none shadow-sm">
                    <div class="flex gap-2"><input type="text" placeholder="MM/YY" class="w-1/2 p-3 rounded-xl border-none shadow-sm"><input type="text" placeholder="CVV" class="w-1/2 p-3 rounded-xl border-none shadow-sm"></div>
                </div>
                <div class="flex justify-between py-5 border-t-2 border-dashed mt-6"><span class="font-black text-slate-400">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span class="text-3xl font-black text-blue-900">${total}ï·¼</span></div>
                <button onclick="checkout()" class="w-full bg-blue-800 text-white py-6 rounded-[30px] font-black text-xl shadow-2xl active:scale-95 transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>`;
            openModal(h);
        }

        function togglePay(v) { document.getElementById('onlineField').classList.toggle('hidden', v !== 'online'); }

        async function checkout() {
            const n = document.getElementById('userName').value;
            const l = document.getElementById('userLoc').value;
            if(!n || !l) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹");

            const order = {
                cust: n, loc: l, items: cart,
                total: cart.reduce((s,i)=>s+i.price, 0),
                pay: document.getElementById('userPay').value,
                status: 'pending',
                time: new Date().toLocaleTimeString('ar-SA'),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            await db.collection("orders").add(order);
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø³ÙŠØµÙ„Ùƒ Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªØ£ÙƒÙŠØ¯ âœ…");
            cart = []; location.reload();
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± (Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù„Ø­Ø¸ÙŠ) ---
        function startListener() {
            db.collection("orders").orderBy("createdAt", "desc").limit(20).onSnapshot(snap => {
                const h = document.getElementById('liveOrders');
                h.innerHTML = "";
                if(snap.empty) h.innerHTML = `<div class="text-center py-20 opacity-20 font-black">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>`;
                
                snap.forEach(doc => {
                    const o = doc.data();
                    if(o.status === 'pending') playSound();
                    h.innerHTML += `
                        <div class="bg-white p-6 rounded-[40px] shadow-sm border-r-8 ${o.status==='pending'?'border-blue-600':'border-green-500'} mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <div><h4 class="font-black text-lg">${o.cust}</h4><p class="text-[10px] font-bold text-slate-400">${o.loc}</p></div>
                                <span class="text-[10px] bg-slate-100 px-3 py-1 rounded-full font-bold">${o.time}</span>
                            </div>
                            <div class="py-4 border-y border-dashed my-3 space-y-1 text-xs font-bold">
                                ${o.items.map(i => `<div class="flex justify-between"><span>${i.name}</span><span>${i.price}ï·¼</span></div>`).join('')}
                            </div>
                            <div class="flex justify-between items-center pt-2">
                                <span class="text-2xl font-black text-blue-900">${o.total}ï·¼</span>
                                ${o.status === 'pending' ? `<button onclick="approve('${doc.id}')" class="bg-emerald-600 text-white px-8 py-2 rounded-2xl font-black">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</button>` : `<span class="text-emerald-600 font-black">Ù…Ù‚Ø¨ÙˆÙ„ âœ…</span>`}
                            </div>
                        </div>`;
                });
            });
        }

        async function approve(id) { await db.collection("orders").doc(id).update({status:'ok'}); }
        function playSound() { new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play(); }
        function openModal(c) { document.getElementById('modalContent').innerHTML = c; document.getElementById('modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
