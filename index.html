<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡ | 2030</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --main: #059669; --glass: rgba(255, 255, 255, 0.85); }
        body { font-family: 'Tajawal', sans-serif; background: #f0f2f5; color: #1e293b; }
        .glass-nav { background: var(--glass); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.3); }
        .product-card { background: white; border-radius: 30px; overflow: hidden; transition: 0.3s; border: 1px solid rgba(0,0,0,0.05); }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .category-pill { transition: 0.3s; white-space: nowrap; }
        .category-pill.active { background: var(--main); color: white; transform: scale(1.1); box-shadow: 0 10px 15px -3px rgba(5, 150, 105, 0.4); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-left: 8px; }
        .img-zoom { transition: transform 0.5s; }
        .product-card:hover .img-zoom { transform: scale(1.1); }
    </style>
</head>
<body class="pb-32">

    <div id="tracker" class="fixed top-0 left-0 w-full z-[2000] p-4 transform -translate-y-full transition-all duration-500">
        <div class="glass-nav p-6 rounded-[30px] shadow-2xl border-2 border-emerald-500/20">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-black text-emerald-900">Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                <span id="orderID" class="text-[10px] font-bold opacity-50">#----</span>
            </div>
            <div class="flex justify-between relative">
                <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-100 -translate-y-1/2 -z-10"></div>
                <div id="s1" class="bg-white p-2 rounded-full border-2 border-gray-100 text-xs transition-all"><i class="fas fa-paper-plane"></i></div>
                <div id="s2" class="bg-white p-2 rounded-full border-2 border-gray-100 text-xs transition-all"><i class="fas fa-fire"></i></div>
                <div id="s3" class="bg-white p-2 rounded-full border-2 border-gray-100 text-xs transition-all"><i class="fas fa-check-double"></i></div>
            </div>
            <p id="statusMsg" class="text-center mt-4 text-xs font-bold text-emerald-700">Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...</p>
        </div>
    </div>

    <header class="glass-nav sticky top-0 z-[1000] p-6 pb-4 rounded-b-[40px]">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-black text-emerald-950 italic">ÙÙˆØ§Ù„ Ù…Ø±ÙˆÙ‡</h1>
                <p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">Ø§Ù„Ù…Ø°Ø§Ù‚ Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø±Ø¤ÙŠØ© 2030</p>
            </div>
            <div class="w-12 h-12 rounded-2xl bg-emerald-100 flex items-center justify-center text-emerald-600 shadow-inner">
                <i class="fas fa-map-marker-alt"></i>
            </div>
        </div>
        <div id="catList" class="flex gap-4 overflow-x-auto no-scrollbar py-2"></div>
    </header>

    <main class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        <div id="menuGrid" class="contents"></div>
    </main>

    <div id="cartPill" onclick="showOrderReview()" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-md h-20 bg-slate-900 rounded-[30px] shadow-2xl flex items-center justify-between px-8 text-white transform translate-y-32 opacity-0 transition-all duration-500 z-[1500]">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-xl shadow-lg animate__animated animate__pulse animate__infinite">
                <i class="fas fa-shopping-bag"></i>
            </div>
            <div>
                <span id="cartCount" class="block text-[10px] font-bold opacity-50 uppercase">0 ØµÙ†Ù</span>
                <span id="cartTotal" class="text-xl font-black">0 ï·¼</span>
            </div>
        </div>
        <i class="fas fa-arrow-left"></i>
    </div>

    <div id="modal" class="fixed inset-0 z-[3000] hidden bg-black/20 backdrop-blur-md items-end justify-center">
        <div id="modalBox" class="bg-white w-full max-w-xl rounded-t-[50px] p-8 translate-y-full transition-all duration-500 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCcQkEMeeoIHbj_7bbU1TnidZJJOdjAx8s",
            authDomain: "fawal-c9530.firebaseapp.com",
            projectId: "fawal-c9530",
            storageBucket: "fawal-c9530.firebasestorage.app",
            messagingSenderId: "5341806694",
            appId: "1:5341806694:web:746e207ad783dbaac26da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù Ø¨Ø§Ù„ØµÙˆØ±
        const MENU_DATA = {
            "ÙÙˆÙ„ ÙˆØ¹Ø¯Ø³": [
                {id:1, n:"ÙÙˆÙ„ Ù…Ø±ÙˆÙ‡ Ø³Ø§Ø¯Ø©", p:6, img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?auto=format&fit=crop&w=400&q=80"},
                {id:2, n:"Ù‚Ù„Ø§Ø¨Ø© Ø·Ø§ÙˆÙ‡ Ø­Ø§Ø±Ø©", p:7, img:"https://images.unsplash.com/photo-1593584785033-9c7604d0863f?auto=format&fit=crop&w=400&q=80"},
                {id:3, n:"Ø¹Ø¯Ø³ Ø­Ø¬Ø§Ø²ÙŠ", p:6, img:"https://images.unsplash.com/photo-1547592166-23ac45744acd?auto=format&fit=crop&w=400&q=80"}
            ],
            "Ø§Ù„Ù…Ø¹ØµÙˆØ¨ ÙˆØ§Ù„Ø¹Ø±ÙŠÙƒØ©": [
                {id:10, n:"Ø¹Ø±ÙŠÙƒØ© Ù…Ù„ÙƒÙŠ ÙØ§Ø®Ø±", p:16, img:"https://images.unsplash.com/photo-1589113103503-49ef83d89e7c?auto=format&fit=crop&w=400&q=80"},
                {id:11, n:"Ù…Ø¹ØµÙˆØ¨ Ù‚Ø´Ø·Ø© Ø¹Ø³Ù„", p:12, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=400&q=80"}
            ],
            "Ø§Ù„Ù…Ø·Ø¨Ù‚": [
                {id:20, n:"Ù…Ø·Ø¨Ù‚ Ø®Ø¶Ø§Ø±", p:5, img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?auto=format&fit=crop&w=400&q=80"},
                {id:21, n:"Ù…Ø·Ø¨Ù‚ Ù†ÙˆØªÙŠÙ„Ø§", p:8, img:"https://images.unsplash.com/photo-1551024601-bec78aea704b?auto=format&fit=crop&w=400&q=80"}
            ]
        };

        let cart = [];
        let currentCat = "ÙÙˆÙ„ ÙˆØ¹Ø¯Ø³";

        window.onload = () => { renderCats(); renderItems(); checkActiveOrder(); };

        function renderCats() {
            const h = document.getElementById('catList');
            h.innerHTML = Object.keys(MENU_DATA).map(c => `
                <button onclick="setCat('${c}')" class="category-pill px-8 py-3 rounded-2xl font-black bg-white shadow-sm ${currentCat===c?'active':''}">${c}</button>
            `).join('');
        }

        function setCat(c) { currentCat = c; renderCats(); renderItems(); }

        function renderItems() {
            const g = document.getElementById('menuGrid');
            g.innerHTML = MENU_DATA[currentCat].map(i => `
                <div class="product-card animate__animated animate__fadeIn">
                    <div class="h-48 overflow-hidden relative">
                        <img src="${i.img}" class="w-full h-full object-cover img-zoom" alt="${i.n}">
                        <div class="absolute top-4 right-4 bg-white/90 backdrop-blur px-4 py-1 rounded-full font-black text-emerald-700 shadow-sm">${i.p} ï·¼</div>
                    </div>
                    <div class="p-6 flex justify-between items-center">
                        <h3 class="font-black text-lg">${i.n}</h3>
                        <button onclick="addToCart('${i.n}', ${i.p})" class="w-12 h-12 bg-emerald-600 text-white rounded-2xl shadow-lg shadow-emerald-200 active:scale-90 transition">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(n, p) {
            cart.push({n, p, id: Date.now()});
            updateCartUI();
        }

        function updateCartUI() {
            const pill = document.getElementById('cartPill');
            if(cart.length > 0) {
                pill.classList.remove('translate-y-32', 'opacity-0');
                document.getElementById('cartCount').innerText = cart.length + " ØµÙ†Ù";
                document.getElementById('cartTotal').innerText = cart.reduce((s,i)=>s+i.p,0) + " ï·¼";
            } else { pill.classList.add('translate-y-32', 'opacity-0'); }
        }

        function showOrderReview() {
            let h = `<h2 class="text-3xl font-black mb-8 text-center text-emerald-950">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                     <div class="space-y-4 mb-10">`;
            h += cart.map((i, idx) => `
                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-3xl">
                    <span class="font-black">${i.n}</span>
                    <div class="flex items-center gap-4">
                        <span class="font-black text-emerald-600">${i.p} ï·¼</span>
                        <button onclick="removeFromCart(${idx})" class="text-red-400"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`).join('');
            h += `</div>
                  <button onclick="sendOrder()" class="w-full bg-emerald-600 text-white py-6 rounded-3xl font-black text-xl shadow-xl active:scale-95 transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø·Ø¹Ù… ğŸš€</button>`;
            openModal(h);
        }

        async function sendOrder() {
            const order = {
                items: cart,
                total: cart.reduce((s,i)=>s+i.p,0),
                status: 'sent',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            const doc = await db.collection("orders").add(order);
            localStorage.setItem('lastOrder', doc.id);
            cart = []; updateCartUI(); closeModal(); checkActiveOrder();
        }

        function checkActiveOrder() {
            const id = localStorage.getItem('lastOrder');
            if(!id) return;
            db.collection("orders").doc(id).onSnapshot(doc => {
                if(!doc.exists) return;
                const o = doc.data();
                document.getElementById('tracker').classList.remove('-translate-y-full');
                document.getElementById('orderID').innerText = "#" + id.slice(-5);
                
                const s1 = document.getElementById('s1'), s2 = document.getElementById('s2'), s3 = document.getElementById('s3');
                const msg = document.getElementById('statusMsg');

                if(o.status === 'sent') { s1.style.background = '#059669'; s1.style.color = 'white'; msg.innerText = "ÙˆØµÙ„Ù†Ø§ Ø·Ù„Ø¨Ùƒ.. Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙŠØ±Ø§Ø¬Ø¹Ù‡ Ø§Ù„Ø¢Ù†"; }
                if(o.status === 'preparing') { s2.style.background = '#059669'; s2.style.color = 'white'; msg.innerText = "Ø·Ù„Ø¨Ùƒ ÙÙˆÙ‚ Ø§Ù„Ù†Ø§Ø±.. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ”¥"; }
                if(o.status === 'ready') { s3.style.background = '#059669'; s3.style.color = 'white'; msg.innerText = "Ø·Ù„Ø¨Ùƒ Ø¬Ø§Ù‡Ø²! Ø¨Ø§Ù„Ø¹Ø§ÙÙŠØ© Ø¹Ù„ÙŠÙƒ ğŸ˜"; }
            });
        }

        function removeFromCart(idx) { cart.splice(idx,1); updateCartUI(); if(cart.length>0) showOrderReview(); else closeModal(); }
        function openModal(c) { document.getElementById('modalBody').innerHTML = c; document.getElementById('modal').style.display = 'flex'; setTimeout(()=>document.getElementById('modalBox').classList.remove('translate-y-full'),10); }
        function closeModal() { document.getElementById('modalBox').classList.add('translate-y-full'); setTimeout(()=>document.getElementById('modal').style.display='none',400); }
    </script>
</body>
</html>
